# Set ChromeFrame header

<IfModule mod_setenvif.c>
	<IfModule mod_headers.c>
		BrowserMatch MSIE ie
		Header set X-UA-Compatible "IE=Edge,chrome=1" env=ie
		Header append Vary User-Agent
	</IfModule>
</IfModule>

# Allow access from all domains for webfonts

<FilesMatch "\.(ttf|otf|eot|woff|font.css)$">
	<IfModule mod_headers.c>
		Header set Access-Control-Allow-Origin "*"
	</IfModule>
</FilesMatch>

# Proper MIME type for all files

AddType audio/ogg						oga ogg

AddType video/ogg						ogv
AddType video/mp4						mp4
AddType video/webm						webm

AddType image/svg+xml					svg svgz 
AddEncoding gzip						svgz

AddType application/vnd.ms-fontobject	eot
AddType font/truetype					ttf
AddType font/opentype					otf
AddType application/x-font-woff			woff

AddType image/x-icon					ico
AddType image/webp						webp
AddType text/cache-manifest				appcache manifest
AddType text/x-component				htc
AddType application/x-chrome-extension	crx
AddType application/x-xpinstall			xpi
AddType application/octet-stream		safariextz

# gzip compression

<IfModule mod_deflate.c>
	<IfModule mod_setenvif.c>
		<IfModule mod_headers.c>
			SetEnvIfNoCase ^(Accept-EncodXng|X-cept-Encoding|X{15}|~{15}|-{15})$ ^((gzip|deflate)\s,?\s(gzip|deflate)?|X{4,13}|~{4,13}|-{4,13})$ HAVE_Accept-Encoding
			RequestHeader append Accept-Encoding "gzip,deflate" env=HAVE_Accept-Encoding
		</IfModule>
	</IfModule>

	<IfModule filter_module>
		FilterDeclare	COMPRESS
		FilterProvider	COMPRESS	DEFLATE resp=Content-Type /text/(html|css|javascript|plain|x(ml|-component))/
		FilterProvider	COMPRESS	DEFLATE resp=Content-Type /application/(javascript|json|xml|x-javascript)/
		FilterChain		COMPRESS
		FilterProtocol	COMPRESS	change=yes;byteranges=no
	</IfModule>

	<FilesMatch "\.(ttf|otf|eot|svg)$" >
		SetOutputFilter DEFLATE
	</FilesMatch>
</IfModule>

# Caching

<IfModule mod_expires.c>
	ExpiresActive on

	ExpiresDefault                          "access plus 1 month"

	ExpiresByType text/cache-manifest       "access plus 0 seconds"

	ExpiresByType text/html                 "access plus 0 seconds"

	ExpiresByType text/xml                  "access plus 0 seconds"
	ExpiresByType application/xml           "access plus 0 seconds"
	ExpiresByType application/json          "access plus 0 seconds"

	ExpiresByType application/rss+xml       "access plus 1 hour"

	ExpiresByType image/x-icon              "access plus 1 week" 

	ExpiresByType image/gif                 "access plus 1 month"
	ExpiresByType image/png                 "access plus 1 month"
	ExpiresByType image/jpg                 "access plus 1 month"
	ExpiresByType image/jpeg                "access plus 1 month"
	ExpiresByType video/ogg                 "access plus 1 month"
	ExpiresByType audio/ogg                 "access plus 1 month"
	ExpiresByType video/mp4                 "access plus 1 month"
	ExpiresByType video/webm                "access plus 1 month"

	ExpiresByType text/x-component          "access plus 1 month"

	ExpiresByType font/truetype             "access plus 1 month"
	ExpiresByType font/opentype             "access plus 1 month"
	ExpiresByType application/x-font-woff   "access plus 1 month"
	ExpiresByType image/svg+xml             "access plus 1 month"
	ExpiresByType application/vnd.ms-fontobject "access plus 1 month"

	ExpiresByType text/css                  "access plus 2 months"
	ExpiresByType application/javascript    "access plus 2 months"
	ExpiresByType text/javascript           "access plus 2 months"

	<IfModule mod_headers.c>
		Header append Cache-Control "public"
	</IfModule>
</IfModule>

# No need for Etags because of far-future expiration date

FileETag None

# Redirections

<IfModule mod_rewrite.c>
	RewriteEngine On

	# Rewrite "www.domain.com -> domain.com" 
	RewriteCond %{HTTPS} !=on
	RewriteCond %{HTTP_HOST} ^www\.(.+)$ [NC]
	RewriteRule ^(.*)$ http://%1/$1 [R=301,L]

	# Rewrite "domain.com/foo -> domain.com/foo/"
	RewriteCond %{REQUEST_FILENAME} !-f
	RewriteCond %{REQUEST_URI} !(\.[a-zA-Z0-9]{1,5}|/|#(.*))$
	RewriteRule ^(.*)$ /$1/ [R=301,L]

	# Block access to "hidden" directories whose names begin with a period.
	RewriteRule "(^|/)\." - [F]

	#
	# STACEY RULES
	#
	# Rewrite any calls to *.html, *.json, *.xml, *.atom, *.rss, *.rdf or *.txt if a folder matching * exists
	RewriteCond %{REQUEST_FILENAME} !-f
	RewriteCond %{REQUEST_URI} !public/
	RewriteCond %{DOCUMENT_ROOT}/public/$1.$2 !-f
	RewriteRule (.+)\.(html|json|xml|atom|rss|rdf|txt)$ $1/ [L]

	# Add a trailing slash to directories
	RewriteCond %{REQUEST_FILENAME} !-f
	RewriteCond %{REQUEST_FILENAME} !-d
	RewriteCond %{REQUEST_URI} !(\.)
	RewriteCond %{REQUEST_URI} !(.*)/$
	RewriteRule ([^/]+)$ $1/ [L]

	# Rewrite any calls to /* or /app to the index.php file
	RewriteCond %{REQUEST_URI} /app/$
	RewriteRule ^app/ index.php [L]
	RewriteCond %{REQUEST_FILENAME} !-f
	RewriteCond %{REQUEST_FILENAME} !-d
	RewriteRule ^(.*)/$ index.php?$1 [L]

	# Rewrite any file calls to the public directory
	RewriteCond %{REQUEST_FILENAME} !-f
	RewriteCond %{REQUEST_FILENAME} !-d
	RewriteCond %{REQUEST_URI} !public/
	RewriteRule ^(.+)$ public/$1 [L]
</IfModule>

# Apache will give a 404 for a rewrite if a folder of the same name does not exist 
Options -MultiViews

# Disable viewing folder contents
Options -Indexes

# Errors
ErrorDocument 404 /404.html

# Encoding
AddDefaultCharset utf-8
AddCharset utf-8 .html .css .js .xml .json .rss